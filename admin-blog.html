<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Blog Admin Panel | Registra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="assets/css/styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    .admin-tab {
      transition: all 0.2s;
    }
    .admin-tab.active {
      border-bottom: 2px solid #3b82f6;
      color: #fff;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
    }
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      max-height: 90vh;
      overflow-y: auto;
    }
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .shake {
      animation: shake 0.5s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }
  </style>
</head>
<body class="bg-slate-900 text-slate-100 antialiased">
  
  <!-- LOGIN SCREEN -->
  <div id="login-screen" class="login-container">
    <div class="w-full max-w-md mx-4">
      <div class="bg-slate-900 rounded-2xl shadow-2xl p-8 border border-white/10">
        <!-- Logo -->
        <div class="text-center mb-8">
          <img src="assets/images/logo-header.png" alt="Registra logo" class="h-16 w-16 mx-auto mb-4">
          <h1 class="text-3xl font-bold mb-2">Blog Admin Panel</h1>
          <p class="text-slate-400">Sign in to manage your blog</p>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="space-y-6">
          <div>
            <label for="login-email" class="block text-sm font-medium mb-2">Email Address</label>
            <input 
              type="email" 
              id="login-email"
              required
              placeholder="your@email.com"
              class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
            >
          </div>

          <div>
            <label for="login-password" class="block text-sm font-medium mb-2">Password</label>
            <input 
              type="password" 
              id="login-password"
              required
              placeholder="Enter your password"
              class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
            >
          </div>

          <!-- Error Message -->
          <div id="login-error" class="hidden p-4 rounded-lg bg-red-600/20 border border-red-500/50">
            <p class="text-red-400 text-sm font-semibold flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
              </svg>
              <span id="login-error-message">Invalid email or password</span>
            </p>
          </div>

          <button 
            type="submit"
            class="w-full px-6 py-4 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-500 transition-all shadow-xl shadow-blue-600/30 flex items-center justify-center gap-2"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
            </svg>
            Sign In
          </button>
        </form>

        <!-- Footer -->
        <div class="mt-8 pt-6 border-t border-white/10 text-center">
          <p class="text-xs text-slate-400">
            Protected Admin Area • Authorized Access Only
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN DASHBOARD (Hidden until login) -->
  <div id="admin-dashboard" class="hidden">
    <!-- HEADER -->
    <header class="border-b border-white/10 bg-slate-900">
      <div class="mx-auto max-w-7xl px-6">
        <div class="flex h-16 items-center justify-between">
          <div class="flex items-center gap-3">
            <img src="assets/images/logo-header.png" alt="Registra logo" class="h-[2rem] w-[2rem]">
            <div>
              <h1 class="font-bold text-lg">Blog Admin Panel</h1>
              <p class="text-xs text-slate-400">Logged in as <span id="user-email" class="text-blue-400"></span></p>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <a href="blog.html" target="_blank" class="text-sm text-slate-300 hover:text-white transition-colors">
              View Blog →
            </a>
            <button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-500 transition-colors">
              Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-6 py-8">
      <!-- Tabs -->
      <div class="mb-8 border-b border-white/10">
        <nav class="flex gap-8 text-sm">
          <button class="admin-tab active pb-4 font-semibold text-slate-400 hover:text-white" data-tab="posts" onclick="switchTab('posts')">
            Posts
          </button>
          <button class="admin-tab pb-4 font-semibold text-slate-400 hover:text-white" data-tab="new-post" onclick="switchTab('new-post')">
            New Post
          </button>
          <button class="admin-tab pb-4 font-semibold text-slate-400 hover:text-white" data-tab="subscribers" onclick="switchTab('subscribers')">
            Subscribers
          </button>
          <button class="admin-tab pb-4 font-semibold text-slate-400 hover:text-white" data-tab="settings" onclick="switchTab('settings')">
            Settings
          </button>
        </nav>
      </div>

      <!-- POSTS TAB -->
      <div id="tab-posts" class="tab-content">
        <div class="mb-6 flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold">All Blog Posts</h2>
            <p class="text-slate-400 mt-1" id="posts-count">Loading...</p>
          </div>
          <button onclick="switchTab('new-post')" class="px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-500 transition-colors">
            + New Post
          </button>
        </div>

        <!-- Posts Table -->
        <div class="rounded-xl bg-white/5 border border-white/10 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-white/5">
                <tr class="border-b border-white/10">
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Title</th>
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Category</th>
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Author</th>
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Date</th>
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-4 text-center text-xs font-semibold text-slate-400 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="posts-table-body" class="divide-y divide-white/5">
                <!-- Posts will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- NEW/EDIT POST TAB -->
      <div id="tab-new-post" class="tab-content hidden">
        <div class="mb-6">
          <h2 class="text-2xl font-bold" id="form-title">Create New Post</h2>
          <p class="text-slate-400 mt-1">Fill in the details below to publish a new blog post</p>
        </div>

        <form id="post-form" class="space-y-6">
          <input type="hidden" id="post-id">
          
          <!-- Basic Info -->
          <div class="rounded-xl bg-white/5 border border-white/10 p-6">
            <h3 class="text-lg font-semibold mb-4">Basic Information</h3>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2">Title *</label>
                <input 
                  type="text" 
                  id="post-title"
                  required
                  placeholder="How to Document Customer Service Calls"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Slug (URL) *</label>
                <input 
                  type="text" 
                  id="post-slug"
                  required
                  placeholder="how-to-document-customer-service-calls"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <p class="text-xs text-slate-400 mt-1">Auto-generated from title. You can customize it.</p>
              </div>

              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Category *</label>
                  <select 
                    id="post-category"
                    required
                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="Guides">Guides</option>
                    <option value="Consumer Rights">Consumer Rights</option>
                    <option value="Problem Solving">Problem Solving</option>
                    <option value="App Tips">App Tips</option>
                    <option value="Case Studies">Case Studies</option>
                    <option value="News">News</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium mb-2">Author *</label>
                  <input 
                    type="text" 
                    id="post-author"
                    required
                    value="Registra Team"
                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Excerpt *</label>
                <textarea 
                  id="post-excerpt"
                  required
                  rows="3"
                  placeholder="A brief summary of your article (150-200 characters)"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Featured Image URL</label>
                <input 
                  type="text" 
                  id="post-image"
                  placeholder="assets/images/logo2.png"
                  value="assets/images/logo2.png"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
              </div>

              <div class="flex items-center gap-3">
                <input 
                  type="checkbox" 
                  id="post-featured"
                  class="w-5 h-5 rounded bg-white/10 border-white/20 text-blue-600 focus:ring-2 focus:ring-blue-500"
                >
                <label for="post-featured" class="text-sm font-medium">Mark as Featured Post</label>
              </div>
            </div>
          </div>

          <!-- SEO Settings -->
          <div class="rounded-xl bg-white/5 border border-white/10 p-6">
            <h3 class="text-lg font-semibold mb-4">SEO Settings</h3>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2">SEO Title *</label>
                <input 
                  type="text" 
                  id="post-seo-title"
                  required
                  placeholder="How to Document Customer Service Calls - Complete Guide 2025"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <p class="text-xs text-slate-400 mt-1">Optimal length: 50-60 characters</p>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">SEO Description *</label>
                <textarea 
                  id="post-seo-description"
                  required
                  rows="3"
                  placeholder="A compelling description for search engines (150-160 characters)"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                ></textarea>
                <p class="text-xs text-slate-400 mt-1">Optimal length: 150-160 characters</p>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Keywords *</label>
                <input 
                  type="text" 
                  id="post-keywords"
                  required
                  placeholder="customer service, documentation, case management, consumer rights"
                  class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <p class="text-xs text-slate-400 mt-1">Separate keywords with commas</p>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="rounded-xl bg-white/5 border border-white/10 p-6">
            <h3 class="text-lg font-semibold mb-4">Content</h3>
            
            <div>
              <label class="block text-sm font-medium mb-2">Article Content (HTML) *</label>
              <textarea 
                id="post-content"
                required
                rows="20"
                placeholder="<p>Your article content goes here...</p>"
                class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
              ></textarea>
              <p class="text-xs text-slate-400 mt-1">Use HTML tags for formatting. Supported: h2, h3, p, ul, ol, li, strong, blockquote, code</p>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex items-center justify-between gap-4 pt-4">
            <button 
              type="button"
              onclick="cancelEdit()"
              class="px-6 py-3 rounded-lg bg-white/10 text-white font-semibold hover:bg-white/20 transition-colors"
            >
              Cancel
            </button>
            <button 
              type="submit"
              class="px-8 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-500 transition-colors"
            >
              Publish Post
            </button>
          </div>
        </form>
      </div>

      <!-- SUBSCRIBERS TAB -->
      <div id="tab-subscribers" class="tab-content hidden">
        <div class="mb-6">
          <h2 class="text-2xl font-bold">Newsletter Subscribers</h2>
          <p class="text-slate-400 mt-1" id="subscribers-count">Loading...</p>
        </div>

        <div class="rounded-xl bg-white/5 border border-white/10 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-white/5">
                <tr class="border-b border-white/10">
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Email</th>
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Source</th>
                  <th class="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Subscribed Date</th>
                  <th class="px-6 py-4 text-center text-xs font-semibold text-slate-400 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="subscribers-table-body" class="divide-y divide-white/5">
                <!-- Subscribers will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-6 flex justify-end">
          <button onclick="exportSubscribers()" class="px-6 py-3 rounded-lg bg-green-600 text-white font-semibold hover:bg-green-500 transition-colors">
            Export to CSV
          </button>
        </div>
      </div>

      <!-- SETTINGS TAB -->
      <div id="tab-settings" class="tab-content hidden">
        <div class="mb-6">
          <h2 class="text-2xl font-bold">Settings & Tools</h2>
          <p class="text-slate-400 mt-1">Manage your blog data</p>
        </div>

        <div class="space-y-6">
          <!-- Export/Import -->
          <div class="rounded-xl bg-white/5 border border-white/10 p-6">
            <h3 class="text-lg font-semibold mb-4">Data Management</h3>
            
            <div class="space-y-4">
              <div>
                <p class="text-sm text-slate-300 mb-3">Export all blog posts and subscribers as a backup</p>
                <button onclick="exportAllData()" class="px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-500 transition-colors">
                  Export All Data
                </button>
              </div>

              <div class="pt-4 border-t border-white/10">
                <p class="text-sm text-slate-300 mb-3">Import blog data from a backup file</p>
                <input type="file" id="import-file" accept=".json" class="hidden">
                <button onclick="document.getElementById('import-file').click()" class="px-6 py-3 rounded-lg bg-purple-600 text-white font-semibold hover:bg-purple-500 transition-colors">
                  Import Data
                </button>
              </div>
            </div>
          </div>

          <!-- Statistics -->
          <div class="rounded-xl bg-white/5 border border-white/10 p-6">
            <h3 class="text-lg font-semibold mb-4">Statistics</h3>
            
            <div class="grid md:grid-cols-3 gap-6">
              <div class="text-center p-4 rounded-lg bg-blue-600/20 border border-blue-500/30">
                <div class="text-3xl font-bold text-white mb-1" id="stat-posts">0</div>
                <div class="text-sm text-slate-300">Total Posts</div>
              </div>
              <div class="text-center p-4 rounded-lg bg-green-600/20 border border-green-500/30">
                <div class="text-3xl font-bold text-white mb-1" id="stat-subscribers">0</div>
                <div class="text-sm text-slate-300">Subscribers</div>
              </div>
              <div class="text-center p-4 rounded-lg bg-purple-600/20 border border-purple-500/30">
                <div class="text-3xl font-bold text-white mb-1" id="stat-categories">0</div>
                <div class="text-sm text-slate-300">Categories</div>
              </div>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="rounded-xl bg-red-600/10 border border-red-500/30 p-6">
            <h3 class="text-lg font-semibold mb-4 text-red-400">Danger Zone</h3>
            
            <div>
              <p class="text-sm text-slate-300 mb-3">⚠️ This will delete all blog posts and subscribers. This action cannot be undone.</p>
              <button onclick="clearAllData()" class="px-6 py-3 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-500 transition-colors">
                Clear All Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content bg-slate-800 rounded-2xl p-8 max-w-md mx-4">
      <h3 class="text-2xl font-bold mb-4">Confirm Deletion</h3>
      <p class="text-slate-300 mb-6">Are you sure you want to delete this post? This action cannot be undone.</p>
      <div class="flex gap-4">
        <button onclick="closeDeleteModal()" class="flex-1 px-6 py-3 rounded-lg bg-white/10 text-white font-semibold hover:bg-white/20 transition-colors">
          Cancel
        </button>
        <button onclick="confirmDelete()" class="flex-1 px-6 py-3 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-500 transition-colors">
          Delete
        </button>
      </div>
    </div>
  </div>

  <script src="assets/js/blog-manager.js"></script>
  <script>
    // Authentication System
    const AUTHORIZED_USERS = {
      'allan.morethson@gmail.com': 'Mateo@1923',
      'allan@registraa.com': 'Mateo@1923'
    };

    // Check if user is logged in on page load
    function checkAuth() {
      const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
      const userEmail = sessionStorage.getItem('adminEmail');
      
      if (isLoggedIn === 'true' && userEmail) {
        showDashboard(userEmail);
      } else {
        showLogin();
      }
    }

    // Show login screen
    function showLogin() {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('admin-dashboard').classList.add('hidden');
    }

    // Show dashboard
    function showDashboard(email) {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('admin-dashboard').classList.remove('hidden');
      document.getElementById('user-email').textContent = email;
      loadPosts();
    }

    // Login form handler
    document.getElementById('login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = document.getElementById('login-email').value.trim().toLowerCase();
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');
      const errorMessage = document.getElementById('login-error-message');
      const loginForm = document.getElementById('login-form');
      
      // Check credentials
      if (AUTHORIZED_USERS[email] && AUTHORIZED_USERS[email] === password) {
        // Successful login
        sessionStorage.setItem('adminLoggedIn', 'true');
        sessionStorage.setItem('adminEmail', email);
        showDashboard(email);
        
        // Clear form
        document.getElementById('login-email').value = '';
        document.getElementById('login-password').value = '';
        errorDiv.classList.add('hidden');
      } else {
        // Failed login
        errorMessage.textContent = 'Invalid email or password. Access denied.';
        errorDiv.classList.remove('hidden');
        loginForm.classList.add('shake');
        
        // Remove shake animation after it completes
        setTimeout(() => {
          loginForm.classList.remove('shake');
        }, 500);
        
        // Clear password field
        document.getElementById('login-password').value = '';
      }
    });

    // Logout function
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        sessionStorage.removeItem('adminLoggedIn');
        sessionStorage.removeItem('adminEmail');
        showLogin();
      }
    }

    // Initialize auth check on page load
    document.addEventListener('DOMContentLoaded', function() {
      checkAuth();
    });

    // Prevent unauthorized access by checking auth before every action
    function requireAuth(callback) {
      const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
      if (isLoggedIn === 'true') {
        callback();
      } else {
        alert('Session expired. Please login again.');
        showLogin();
      }
    }

    let postToDelete = null;

    // Tab switching
    function switchTab(tabName) {
      requireAuth(() => {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.add('hidden');
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.admin-tab').forEach(btn => {
          btn.classList.remove('active', 'text-white');
          btn.classList.add('text-slate-400');
        });
        
        // Show selected tab
        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        
        // Add active class to clicked button
        const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
        activeBtn.classList.add('active', 'text-white');
        activeBtn.classList.remove('text-slate-400');
        
        // Load tab content
        if (tabName === 'posts') {
          loadPosts();
        } else if (tabName === 'subscribers') {
          loadSubscribers();
        } else if (tabName === 'settings') {
          loadStatistics();
        } else if (tabName === 'new-post') {
          resetForm();
        }
      });
    }

    // Load all posts
    function loadPosts() {
      const posts = BlogManager.getAllPosts();
      const tbody = document.getElementById('posts-table-body');
      
      document.getElementById('posts-count').textContent = `${posts.length} post${posts.length !== 1 ? 's' : ''} total`;
      
      if (posts.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-12 text-center text-slate-400">
              No posts yet. Create your first post!
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = posts.map(post => `
        <tr class="hover:bg-white/5 transition-colors">
          <td class="px-6 py-4">
            <div class="font-medium text-white">${post.title}</div>
            <div class="text-xs text-slate-400 mt-1">${post.slug}</div>
          </td>
          <td class="px-6 py-4">
            <span class="px-2 py-1 bg-blue-600/20 text-blue-300 text-xs font-semibold rounded">
              ${post.category}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-slate-300">${post.author}</td>
          <td class="px-6 py-4 text-sm text-slate-400">
            ${new Date(post.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
          </td>
          <td class="px-6 py-4">
            ${post.featured ? '<span class="px-2 py-1 bg-yellow-600/20 text-yellow-300 text-xs font-semibold rounded">Featured</span>' : '<span class="text-slate-400 text-xs">Published</span>'}
          </td>
          <td class="px-6 py-4 text-center">
            <div class="flex items-center justify-center gap-2">
              <button onclick="editPost('${post.id}')" class="px-3 py-1 rounded bg-blue-600 text-white text-xs font-semibold hover:bg-blue-500 transition-colors">
                Edit
              </button>
              <button onclick="deletePostConfirm('${post.id}')" class="px-3 py-1 rounded bg-red-600 text-white text-xs font-semibold hover:bg-red-500 transition-colors">
                Delete
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Load subscribers
    function loadSubscribers() {
      const subscribers = BlogManager.getAllSubscribers();
      const tbody = document.getElementById('subscribers-table-body');
      
      document.getElementById('subscribers-count').textContent = `${subscribers.length} subscriber${subscribers.length !== 1 ? 's' : ''} total`;
      
      if (subscribers.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="px-6 py-12 text-center text-slate-400">
              No subscribers yet.
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = subscribers.map(sub => `
        <tr class="hover:bg-white/5 transition-colors">
          <td class="px-6 py-4 text-sm text-white">${sub.email}</td>
          <td class="px-6 py-4">
            <span class="px-2 py-1 bg-green-600/20 text-green-300 text-xs font-semibold rounded">
              ${sub.source}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-slate-400">
            ${new Date(sub.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
          </td>
          <td class="px-6 py-4 text-center">
            <button onclick="copyEmail('${sub.email}')" class="px-3 py-1 rounded bg-white/10 text-white text-xs font-semibold hover:bg-white/20 transition-colors">
              Copy
            </button>
          </td>
        </tr>
      `).join('');
    }

    // Load statistics
    function loadStatistics() {
      const posts = BlogManager.getAllPosts();
      const subscribers = BlogManager.getAllSubscribers();
      const categories = BlogManager.getAllCategories();
      
      document.getElementById('stat-posts').textContent = posts.length;
      document.getElementById('stat-subscribers').textContent = subscribers.length;
      document.getElementById('stat-categories').textContent = categories.length;
    }

    // Form handling
    document.getElementById('post-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      requireAuth(() => {
        const post = {
          id: document.getElementById('post-id').value || undefined,
          title: document.getElementById('post-title').value,
          slug: document.getElementById('post-slug').value,
          excerpt: document.getElementById('post-excerpt').value,
          content: document.getElementById('post-content').value,
          author: document.getElementById('post-author').value,
          category: document.getElementById('post-category').value,
          image: document.getElementById('post-image').value,
          featured: document.getElementById('post-featured').checked,
          seoTitle: document.getElementById('post-seo-title').value,
          seoDescription: document.getElementById('post-seo-description').value,
          keywords: document.getElementById('post-keywords').value
        };
        
        const result = BlogManager.savePost(post);
        
        if (result) {
          alert('Post saved successfully!');
          switchTab('posts');
        } else {
          alert('Error saving post. Please try again.');
        }
      });
    });

    // Auto-generate slug from title
    document.getElementById('post-title').addEventListener('input', function() {
      const slug = BlogManager.generateSlug(this.value);
      document.getElementById('post-slug').value = slug;
    });

    // Edit post
    function editPost(id) {
      requireAuth(() => {
        const post = BlogManager.getPostById(id);
        if (!post) return;
        
        document.getElementById('form-title').textContent = 'Edit Post';
        document.getElementById('post-id').value = post.id;
        document.getElementById('post-title').value = post.title;
        document.getElementById('post-slug').value = post.slug;
        document.getElementById('post-excerpt').value = post.excerpt;
        document.getElementById('post-content').value = post.content;
        document.getElementById('post-author').value = post.author;
        document.getElementById('post-category').value = post.category;
        document.getElementById('post-image').value = post.image;
        document.getElementById('post-featured').checked = post.featured || false;
        document.getElementById('post-seo-title').value = post.seoTitle;
        document.getElementById('post-seo-description').value = post.seoDescription;
        document.getElementById('post-keywords').value = post.keywords;
        
        switchTab('new-post');
      });
    }

    // Reset form
    function resetForm() {
      document.getElementById('form-title').textContent = 'Create New Post';
      document.getElementById('post-form').reset();
      document.getElementById('post-id').value = '';
      document.getElementById('post-image').value = 'assets/images/logo2.png';
      document.getElementById('post-author').value = 'Registra Team';
    }

    // Cancel edit
    function cancelEdit() {
      resetForm();
      switchTab('posts');
    }

    // Delete post confirmation
    function deletePostConfirm(id) {
      requireAuth(() => {
        postToDelete = id;
        document.getElementById('delete-modal').classList.add('active');
      });
    }

    function closeDeleteModal() {
      postToDelete = null;
      document.getElementById('delete-modal').classList.remove('active');
    }

    function confirmDelete() {
      if (postToDelete) {
        BlogManager.deletePost(postToDelete);
        closeDeleteModal();
        loadPosts();
      }
    }

    // Export subscribers to CSV
    function exportSubscribers() {
      requireAuth(() => {
        const subscribers = BlogManager.getAllSubscribers();
        let csv = 'Email,Source,Date\n';
        
        subscribers.forEach(sub => {
          csv += `${sub.email},${sub.source},${new Date(sub.date).toLocaleDateString()}\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `subscribers-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      });
    }

    // Copy email
    function copyEmail(email) {
      navigator.clipboard.writeText(email).then(() => {
        alert('Email copied to clipboard!');
      });
    }

    // Export all data
    function exportAllData() {
      requireAuth(() => {
        const data = BlogManager.exportData();
        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `blog-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
      });
    }

    // Import data
    document.getElementById('import-file').addEventListener('change', function(e) {
      requireAuth(() => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            const success = BlogManager.importData(data);
            
            if (success) {
              alert('Data imported successfully!');
              loadPosts();
              loadSubscribers();
              loadStatistics();
            } else {
              alert('Error importing data. Please check the file format.');
            }
          } catch (error) {
            alert('Error parsing file. Please ensure it\'s a valid JSON file.');
          }
        };
        reader.readAsText(file);
      });
    });

    // Clear all data
    function clearAllData() {
      requireAuth(() => {
        if (!confirm('⚠️ WARNING: This will delete ALL blog posts and subscribers. This cannot be undone. Are you absolutely sure?')) {
          return;
        }
        
        if (!confirm('Last chance! Type DELETE in the next prompt to confirm.')) {
          return;
        }
        
        const confirmation = prompt('Type DELETE to confirm:');
        if (confirmation === 'DELETE') {
          localStorage.removeItem('blogPosts');
          localStorage.removeItem('newsletterSubscribers');
          alert('All data has been cleared.');
          location.reload();
        }
      });
    }
  </script>
</body>
</html>
